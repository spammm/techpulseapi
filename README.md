# TechPulse API

TechPulse API — это серверная часть для новостного портала [TechPulse](https://github.com/spammm/techpulseclient), предоставляющая функционал для управления постами, пользователями, комментариями, тегами и изображениями. Он построен на [NestJS](https://nestjs.com/) с использованием TypeScript и TypeORM для взаимодействия с базой данных. Приложение разработана для работы с [клиентским сайтом](https://github.com/spammm/techpulseclient) и [админкой](https://github.com/spammm/techpulseadmin).

## Оглавление

- [Функциональные возможности](#функциональные-возможности)
- [Технологический стек](#технологический-стек)
- [Установка и запуск](#установка-и-запуск)
- [Создание администратора](#создание-администратора)
- [Миграции базы данных](#миграции-базы-данных)
- [Скрипты](#скрипты)
- [Роли и доступы](#роли-и-доступы)
- [Контрибьюция](#контрибьюция)

## Функциональные возможности

- **Управление постами**: Создание, редактирование и удаление новостей, поддержка изображений для постов.
- **Управление пользователями**: Создание пользователей, редактирование профилей и назначение ролей.
- **Управление комментариями**: Добавление, редактирование и удаление комментариев.
- **Управление тегами**: Создание и редактирование тегов, присвоение их постам.
- **Модерация**: Возможность управления контентом (комментарии, посты) для администраторов и модераторов.
- **Email-уведомления**: Поддержка email-уведомлений для подтверждения регистрации, восстановления пароля и других действий.
- **Интеграция с Telegram**: Возможность отправки уведомлений через Telegram.
- **Поддержка авторизации с JWT токеном**: создает токен авторизации и токен для обновления токена авторизации.
- **Поддержка социального входа**: Возможность авторизации через социальные сети (Google, VK, Yandex).
- **SEO-оптимизация**: Включает поддержку генерации `sitemap.xml` и отправку ссылок для индексации в Google.

## Технологический стек

- **Фреймворк:** [NestJS](https://nestjs.com/)
- **Язык:** TypeScript
- **База данных:** PostgreSQL (поддержка других баз через TypeORM)
- **ORM:** [TypeORM](https://typeorm.io/)
- **Аутентификация:** JWT через [NextAuth](https://next-auth.js.org/)
- **Миграции базы данных:** TypeORM

## Установка и запуск

1. **Клонируйте репозиторий:**

```bash
   git clone https://github.com/spammm/techpulseapi.git
```

2.  **Перейдите в директорию проекта:**

```bash
cd techpulseapi
```

3.  **Установите зависимости:**

```bash
    npm install
```

4.  **Настройте файл окружения:** Скопируйте `.env.example` в `.env` и укажите все необходимые переменные окружения.

```bash
cp .env.example .env
```

5.  **Создайте базу данных:** Убедитесь, что у вас настроена PostgreSQL база данных, и внесите её данные в `.env`.
6.  **Запустите сервер в режиме разработки:**

```bash
npm run start:dev
```

API будет доступен по адресу [http://localhost:9000](http://localhost:9000).
Для входа в [админку](https://github.com/spammm/techpulseadmin) вам необходимо будет создать администратор, шаги ниже.

## Создание администратора

1.  Для создания администратора выполните команду:

```bash
npx ts-node create-admin.ts
```

2.  По умолчанию создается администратор с логином `admin` и паролем `1`. Рекомендуется сменить пароль после первого входа.

## Миграции базы данных

Для создания и запуска миграций выполните следующие шаги:

1.  **Добавьте новые сущности в файл `src/data-source.ts`, если необходимо.**
2.  **Создайте файл миграции:**

```bash
npx ts-node -r tsconfig-paths/register ./node_modules/typeorm/cli migration:generate -d src/data-source.ts src/migrations/AddKeywordsColumnToPost
```

3.  **Запустите миграции:**

```bash
npx ts-node -r tsconfig-paths/register ./node_modules/typeorm/cli migration:run -d src/data-source.ts
```

## Скрипты

- `start:dev`: Запускает сервер в режиме разработки.
- `start`: Запускает сервер в продакшн-режиме.
- `build`: Собирает приложение для продакшн.
- `lint`: Проверяет код на соответствие стилям и потенциальные ошибки.
- `migration:generate`: Генерирует миграцию на основе изменений в сущностях.
- `migration:run`: Применяет миграции к базе данных.

## Роли и доступы

API сервер поддерживает различные роли пользователей:

- **Администратор**: Полный доступ ко всем ресурсам API, включая управление пользователями, постами и комментариями.
- **Модератор(manager)**: Может управлять постами и комментариями, создавать/редактировать авторов и клиентов.
- **Автор**: Может создавать и редактировать только свои посты.
- **Пользователь**: Может читать и комментировать посты.

## Контрибьюция

Если вы хотите внести изменения или улучшения в проект, пожалуйста, создайте форк репозитория и отправьте пул-реквест с вашими предложениями.
